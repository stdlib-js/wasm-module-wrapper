// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.2.2-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-collection@v0.2.2-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-arraybuffer@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.2.2-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.2.2-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-wasm-support@v0.2.2-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/object-assign@v0.2.2-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.2.2-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/array-dataview@v0.2.2-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-bytes-per-element@v0.2.2-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ceil@v0.2.2-esm/index.mjs";import{ndarray as u}from"https://cdn.jsdelivr.net/gh/stdlib-js/strided-base-write-dataview@esm/index.mjs";import{ndarray as f}from"https://cdn.jsdelivr.net/gh/stdlib-js/strided-base-read-dataview@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/array-dtype@v0.3.0-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/wasm-base-dtype2wasm@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.2-esm/index.mjs";var b=o();function v(e,t,n){if(!(this instanceof v))return new v(e,t,arguments.length>2?n:{});if(!b)throw new Error("unexpected error. Environment does not support WebAssembly.");return r(e)&&(e=new l(e)),this._binary=e,this._module=null,this._instance=null,this._imports=n,t?(this._memory=t,this._view=new h(t.buffer),this._buffer=new l(t.buffer)):(this._memory=null,this._view=null,this._buffer=null),this}s(v.prototype,"binary",(function(){return this._binary.slice()})),s(v.prototype,"memory",(function(){return this._memory})),s(v.prototype,"buffer",(function(){return this._buffer})),s(v.prototype,"view",(function(){return this._view})),s(v.prototype,"exports",(function(){return this._instance?m({},this._instance.exports):null})),i(v.prototype,"initialize",(function(){var e,t;return e=this,t=this._instance?function(t){t(e)}:function(t,r){function n(r,n){e._module=r,e._instance=n,t(e)}function i(e){r(e)}WebAssembly.instantiate(e._binary,e._imports).then(n,i)},new Promise(t)})),i(v.prototype,"initializeAsync",(function(e){var t;if(!n(e))throw new TypeError(y("null3J",e));if(this._instance)return e(null,this);t=this,WebAssembly.instantiate(this._binary,this._imports).then((function(r,n){t._module=r,t._instance=n,e(null,t)}),(function(t){e(t)}))})),i(v.prototype,"initializeSync",(function(){return this._instance||(this._module=new WebAssembly.Module(this._binary),this._instance=new WebAssembly.Instance(this._module,this._imports)),this})),i(v.prototype,"realloc",(function(t){var r;if(!e(t))throw new TypeError(y("null2K",t));if(null===this._memory)return!1;if((r=d((t-this._buffer.length)/65536))>0){try{this._memory.grow(r)}catch(e){return!1}return this._view=new h(this._memory.buffer),this._buffer=new l(this._memory.buffer),!0}return!1})),i(v.prototype,"hasCapacity",(function(r,n){var i;if(!e(r))throw new TypeError(y("null2d",r));if(!t(n))throw new TypeError(y("null2y",n));return null!==this._memory&&(i=a(c(p(n)||"generic")),!(n.length*i+r>this._buffer.length))})),i(v.prototype,"isView",(function(e){if(!t(e))throw new TypeError(y("null2u",e));return!(!this._memory||!e.buffer)&&e.buffer===this._memory.buffer})),i(v.prototype,"write",(function(r,n){var i;if(null===this._memory)throw new Error("invalid invocation. Unable to perform write operation, as the WebAssembly module is not bound to an underlying WebAssembly memory instance.");if(!e(r))throw new TypeError(y("null2d",r));if(!t(n))throw new TypeError(y("null2y",n));if(i=a(c(p(n)||"generic")),n.length*i+r>this._buffer.length)throw new RangeError("invalid argument. Second argument is incompatible with the specified byte offset and available memory. Resize the underlying memory instance in order to accommodate the list of provided values.");return u(n.length,n,1,0,this._view,i,r,!0),this})),i(v.prototype,"read",(function(r,n){var i;if(null===this._memory)throw new Error("invalid invocation. Unable to perform read operation, as the WebAssembly module is not bound to an underlying WebAssembly memory instance.");if(!e(r))throw new TypeError(y("null2d",r));if(!t(n))throw new TypeError(y("null2y",n));if(i=a(c(p(n)||"generic")),n.length*i+r>this._buffer.length)throw new RangeError("invalid argument. Second argument is incompatible with the specified byte offset and available memory. Not enough values to fill the provided output array.");return f(n.length,this._view,i,r,n,1,0,!0),this}));export{v as default};
//# sourceMappingURL=index.mjs.map
